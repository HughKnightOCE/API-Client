<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApiClient Pro - API Testing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        header p {
            color: #666;
        }

        .tabs {
            display: flex;
            gap: 5px;
            background: white;
            padding: 10px;
            border-radius: 12px 12px 0 0;
            margin-bottom: -1px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tab-button {
            padding: 12px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .tab-button:hover {
            background: #e0e0e0;
        }

        .tab-button.active:hover {
            background: #667eea;
        }

        .content {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        button.secondary {
            background: #f0f0f0;
            color: #333;
        }

        button.secondary:hover {
            background: #e0e0e0;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover {
            background: #c0392b;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f9f9f9;
            font-weight: 600;
            color: #667eea;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #d4edda;
            color: #155724;
        }

        .badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .card p {
            color: #666;
            font-size: 14px;
        }

        .stat {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-box h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .stat-box p {
            font-size: 12px;
            opacity: 0.9;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .editor {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            overflow-x: auto;
            line-height: 1.5;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .stat {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš€ ApiClient Pro</h1>
            <p>Advanced HTTP API Testing & Automation Dashboard</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-button" onclick="switchTab('requests')">Requests</button>
            <button class="tab-button" onclick="switchTab('chains')">Chains</button>
            <button class="tab-button" onclick="switchTab('templates')">Templates</button>
            <button class="tab-button" onclick="switchTab('performance')">Performance</button>
            <button class="tab-button" onclick="switchTab('auth')">Auth</button>
            <button class="tab-button" onclick="switchTab('mocks')">Mocks</button>
            <button class="tab-button" onclick="switchTab('graphql')">GraphQL</button>
            <button class="tab-button" onclick="switchTab('import')">Import/Export</button>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Dashboard</h2>
                <div class="stat">
                    <div class="stat-box">
                        <h3 id="stats-requests">0</h3>
                        <p>Saved Requests</p>
                    </div>
                    <div class="stat-box">
                        <h3 id="stats-chains">0</h3>
                        <p>Request Chains</p>
                    </div>
                    <div class="stat-box">
                        <h3 id="stats-templates">0</h3>
                        <p>Templates</p>
                    </div>
                    <div class="stat-box">
                        <h3 id="stats-metrics">0</h3>
                        <p>Performance Metrics</p>
                    </div>
                </div>
                <h3 style="margin-top: 30px;">Recent Activity</h3>
                <div id="recent-activity"></div>
            </div>

            <!-- Requests Tab -->
            <div id="requests" class="tab-content">
                <h2>Saved Requests</h2>
                <div class="button-group">
                    <button onclick="showCreateRequestModal()">+ New Request</button>
                    <button class="secondary" onclick="loadRequests()">Refresh</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Method</th>
                            <th>URL</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="requests-list"></tbody>
                </table>
            </div>

            <!-- Chains Tab -->
            <div id="chains" class="tab-content">
                <h2>Request Chains</h2>
                <div class="button-group">
                    <button onclick="showCreateChainModal()">+ New Chain</button>
                    <button class="secondary" onclick="loadChains()">Refresh</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Requests</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="chains-list"></tbody>
                </table>
            </div>

            <!-- Templates Tab -->
            <div id="templates" class="tab-content">
                <h2>Request Templates</h2>
                <div class="button-group">
                    <button onclick="showCreateTemplateModal()">+ New Template</button>
                    <button class="secondary" onclick="loadTemplates()">Refresh</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Method</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="templates-list"></tbody>
                </table>
            </div>

            <!-- Performance Tab -->
            <div id="performance" class="tab-content">
                <h2>Performance Monitoring</h2>
                <div class="button-group">
                    <button class="secondary" onclick="loadMetrics()">Refresh</button>
                    <button class="secondary" onclick="showMetricsStats()">View Statistics</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>Status</th>
                            <th>Response Time</th>
                            <th>Size</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody id="metrics-list"></tbody>
                </table>
            </div>

            <!-- Authentication Tab -->
            <div id="auth" class="tab-content">
                <h2>Authentication Configurations</h2>
                <div class="button-group">
                    <button onclick="showCreateAuthModal()">+ New Config</button>
                    <button class="secondary" onclick="loadAuthConfigs()">Refresh</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="auth-list"></tbody>
                </table>
            </div>

            <!-- Mocks Tab -->
            <div id="mocks" class="tab-content">
                <h2>Mock Endpoints</h2>
                <div class="button-group">
                    <button onclick="showCreateMockModal()">+ New Mock</button>
                    <button class="secondary" onclick="loadMocks()">Refresh</button>
                    <button class="secondary" onclick="startMockServer()">Start Server</button>
                    <button class="secondary danger" onclick="stopMockServer()">Stop Server</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Path</th>
                            <th>Method</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="mocks-list"></tbody>
                </table>
            </div>

            <!-- GraphQL Tab -->
            <div id="graphql" class="tab-content">
                <h2>GraphQL Queries</h2>
                <div class="button-group">
                    <button onclick="showCreateGraphQLModal()">+ New Query</button>
                    <button class="secondary" onclick="loadGraphQLQueries()">Refresh</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Endpoint</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="graphql-list"></tbody>
                </table>
            </div>

            <!-- Import/Export Tab -->
            <div id="import" class="tab-content">
                <h2>Import & Export</h2>
                <div class="grid">
                    <div class="card">
                        <h3>Import Requests</h3>
                        <p>Import from Postman, Insomnia, or OpenAPI formats</p>
                        <div class="form-group">
                            <label>Format</label>
                            <select id="import-format">
                                <option value="postman">Postman Collection</option>
                                <option value="insomnia">Insomnia Export</option>
                                <option value="openapi">OpenAPI Spec</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>File</label>
                            <input type="file" id="import-file" accept=".json">
                        </div>
                        <button onclick="importRequests()">Import</button>
                    </div>

                    <div class="card">
                        <h3>Export Requests</h3>
                        <p>Export all requests in your preferred format</p>
                        <div class="form-group">
                            <label>Format</label>
                            <select id="export-format">
                                <option value="json">JSON</option>
                                <option value="postman">Postman Collection</option>
                            </select>
                        </div>
                        <button onclick="exportRequests()">Export</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Request Modal -->
    <div id="request-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create Request</h2>
                <button class="close-button" onclick="closeRequestModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="req-name" placeholder="e.g., Get Users">
            </div>
            <div class="form-group">
                <label>Method</label>
                <select id="req-method">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="PATCH">PATCH</option>
                    <option value="DELETE">DELETE</option>
                </select>
            </div>
            <div class="form-group">
                <label>URL</label>
                <input type="text" id="req-url" placeholder="https://api.example.com/users">
            </div>
            <div class="form-group">
                <label>Headers (JSON)</label>
                <textarea id="req-headers" placeholder='{"Authorization": "Bearer token"}'></textarea>
            </div>
            <div class="form-group">
                <label>Body (JSON)</label>
                <textarea id="req-body" placeholder='{"key": "value"}'></textarea>
            </div>
            <button onclick="saveRequest()">Save Request</button>
        </div>
    </div>

    <!-- Chain Modal -->
    <div id="chain-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create Chain</h2>
                <button class="close-button" onclick="closeChainModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="chain-name" placeholder="e.g., User Workflow">
            </div>
            <div class="form-group">
                <label>Requests (JSON array)</label>
                <textarea id="chain-requests" placeholder='["request1", "request2", "request3"]'></textarea>
            </div>
            <button onclick="saveChain()">Create Chain</button>
        </div>
    </div>

    <!-- Template Modal -->
    <div id="template-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create Template</h2>
                <button class="close-button" onclick="closeTemplateModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="template-name" placeholder="e.g., REST API">
            </div>
            <div class="form-group">
                <label>Category</label>
                <input type="text" id="template-category" placeholder="e.g., REST, GraphQL">
            </div>
            <div class="form-group">
                <label>Method</label>
                <select id="template-method">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                </select>
            </div>
            <div class="form-group">
                <label>URL Template</label>
                <input type="text" id="template-url" placeholder="https://api.example.com/v1/{resource}">
            </div>
            <button onclick="saveTemplate()">Save Template</button>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create Auth Config</h2>
                <button class="close-button" onclick="closeAuthModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="auth-name" placeholder="e.g., My API Key">
            </div>
            <div class="form-group">
                <label>Type</label>
                <select id="auth-type">
                    <option value="api_key">API Key</option>
                    <option value="bearer">Bearer Token</option>
                    <option value="oauth2">OAuth2</option>
                </select>
            </div>
            <div class="form-group">
                <label>API Key</label>
                <input type="password" id="auth-key" placeholder="Your API key">
            </div>
            <button onclick="saveAuth()">Save</button>
        </div>
    </div>

    <!-- Mock Modal -->
    <div id="mock-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create Mock Endpoint</h2>
                <button class="close-button" onclick="closeMockModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="mock-name" placeholder="e.g., User Response">
            </div>
            <div class="form-group">
                <label>Path</label>
                <input type="text" id="mock-path" placeholder="/api/users">
            </div>
            <div class="form-group">
                <label>Method</label>
                <select id="mock-method">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                </select>
            </div>
            <div class="form-group">
                <label>Response (JSON)</label>
                <textarea id="mock-response" placeholder='{"id": 1, "name": "John"}'></textarea>
            </div>
            <button onclick="saveMock()">Create Mock</button>
        </div>
    </div>

    <!-- GraphQL Modal -->
    <div id="graphql-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Create GraphQL Query</h2>
                <button class="close-button" onclick="closeGraphQLModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="graphql-name" placeholder="e.g., Get Users">
            </div>
            <div class="form-group">
                <label>Endpoint</label>
                <input type="text" id="graphql-endpoint" placeholder="https://api.example.com/graphql">
            </div>
            <div class="form-group">
                <label>Query</label>
                <textarea id="graphql-query" placeholder='{ users { id name email } }'></textarea>
            </div>
            <button onclick="saveGraphQL()">Create Query</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/api';

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');

            // Load data for the tab
            if (tab === 'dashboard') loadDashboard();
            else if (tab === 'requests') loadRequests();
            else if (tab === 'chains') loadChains();
            else if (tab === 'templates') loadTemplates();
            else if (tab === 'performance') loadMetrics();
            else if (tab === 'auth') loadAuthConfigs();
            else if (tab === 'mocks') loadMocks();
            else if (tab === 'graphql') loadGraphQLQueries();
        }

        // Dashboard
        async function loadDashboard() {
            const data = await Promise.all([
                fetch(`${API_URL}/requests`).then(r => r.json()),
                fetch(`${API_URL}/chains`).then(r => r.json()),
                fetch(`${API_URL}/templates`).then(r => r.json()),
                fetch(`${API_URL}/metrics`).then(r => r.json()),
            ]);

            document.getElementById('stats-requests').textContent = data[0].count || 0;
            document.getElementById('stats-chains').textContent = data[1].count || 0;
            document.getElementById('stats-templates').textContent = data[2].count || 0;
            document.getElementById('stats-metrics').textContent = data[3].count || 0;
        }

        // Requests
        async function loadRequests() {
            const response = await fetch(`${API_URL}/requests`);
            const data = await response.json();

            const list = document.getElementById('requests-list');
            list.innerHTML = data.requests.map(req => `
                <tr>
                    <td>${req.name}</td>
                    <td><span class="badge">${req.method}</span></td>
                    <td>${req.url}</td>
                    <td>
                        <button class="secondary" style="font-size: 12px; padding: 6px 12px;" onclick="runRequest('${req.name}')">Run</button>
                        <button class="danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteRequest('${req.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function showCreateRequestModal() {
            document.getElementById('request-modal').classList.add('active');
        }

        async function saveRequest() {
            const request = {
                name: document.getElementById('req-name').value,
                method: document.getElementById('req-method').value,
                url: document.getElementById('req-url').value,
                headers: JSON.parse(document.getElementById('req-headers').value || '{}'),
                body: document.getElementById('req-body').value,
            };

            try {
                const response = await fetch(`${API_URL}/requests`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(request)
                });
                const data = await response.json();
                if (!response.ok) {
                    alert(`Error: ${data.detail || data.error || 'Unknown error'}`);
                    return;
                }
                alert('Request saved!');
                closeRequestModal();
                loadRequests();
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        async function deleteRequest(name) {
            if (confirm(`Delete request "${name}"?`)) {
                await fetch(`${API_URL}/requests/${name}`, { method: 'DELETE' });
                loadRequests();
            }
        }

        async function runRequest(name) {
            try {
                const response = await fetch(`${API_URL}/requests/${name}/execute`, { method: 'POST' });
                const data = await response.json();
                if (!response.ok) {
                    alert(`Error: ${data.detail || data.error || 'Unknown error'}`);
                    return;
                }
                const timeStr = data.time_taken ? data.time_taken.toFixed(2) : '0.00';
                alert(`Request executed!\n\nStatus: ${data.status_code}\nTime: ${timeStr}ms\nSize: ${data.size} bytes\n\nResponse:\n${JSON.stringify(data.response, null, 2)}`);
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        // Chains
        async function loadChains() {
            const response = await fetch(`${API_URL}/chains`);
            const data = await response.json();

            const list = document.getElementById('chains-list');
            list.innerHTML = data.chains.map(chain => `
                <tr>
                    <td>${chain.name}</td>
                    <td>${chain.requests}</td>
                    <td>
                        <button class="secondary" style="font-size: 12px; padding: 6px 12px;" onclick="executeChain('${chain.name}')">Execute</button>
                        <button class="danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteChain('${chain.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function showCreateChainModal() {
            document.getElementById('chain-modal').classList.add('active');
        }

        async function saveChain() {
            const chain = {
                name: document.getElementById('chain-name').value,
                requests: JSON.parse(document.getElementById('chain-requests').value || '[]'),
            };

            try {
                await fetch(`${API_URL}/chains`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(chain)
                });
                alert('Chain created!');
                closeChainModal();
                loadChains();
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Templates
        async function loadTemplates() {
            const response = await fetch(`${API_URL}/templates`);
            const data = await response.json();

            const list = document.getElementById('templates-list');
            list.innerHTML = data.templates.map(template => `
                <tr>
                    <td>${template.name}</td>
                    <td>${template.category}</td>
                    <td><span class="badge">${template.method}</span></td>
                    <td>
                        <button class="secondary" style="font-size: 12px; padding: 6px 12px;" onclick="useTemplate('${template.name}')">Use</button>
                        <button class="danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteTemplate('${template.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function showCreateTemplateModal() {
            document.getElementById('template-modal').classList.add('active');
        }

        async function saveTemplate() {
            const template = {
                name: document.getElementById('template-name').value,
                category: document.getElementById('template-category').value,
                method: document.getElementById('template-method').value,
                url: document.getElementById('template-url').value,
                headers: JSON.parse(document.getElementById('template-headers').value || '{}'),
                body: document.getElementById('template-body').value,
            };

            try {
                await fetch(`${API_URL}/templates`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(template)
                });
                alert('Template saved!');
                closeTemplateModal();
                loadTemplates();
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Metrics
        async function loadMetrics() {
            const response = await fetch(`${API_URL}/metrics`);
            const data = await response.json();

            const list = document.getElementById('metrics-list');
            list.innerHTML = data.metrics.map(m => `
                <tr>
                    <td>${m.endpoint}</td>
                    <td><span class="badge ${m.status_code < 400 ? 'success' : 'danger'}">${m.status_code}</span></td>
                    <td>${m.response_time.toFixed(2)}ms</td>
                    <td>${m.size} bytes</td>
                    <td>${m.timestamp}</td>
                </tr>
            `).join('');
        }

        // Auth
        async function loadAuthConfigs() {
            const response = await fetch(`${API_URL}/auth`);
            const data = await response.json();

            const list = document.getElementById('auth-list');
            list.innerHTML = data.configs.map(auth => `
                <tr>
                    <td>${auth.name}</td>
                    <td><span class="badge info">${auth.type}</span></td>
                    <td>
                        <button class="danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteAuth('${auth.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function showCreateAuthModal() {
            document.getElementById('auth-modal').classList.add('active');
        }

        async function saveAuth() {
            const auth = {
                name: document.getElementById('auth-name').value,
                type: document.getElementById('auth-type').value,
                credentials: document.getElementById('auth-credentials').value,
            };

            try {
                await fetch(`${API_URL}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(auth)
                });
                alert('Auth config saved!');
                closeAuthModal();
                loadAuthConfigs();
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Mocks
        async function loadMocks() {
            const response = await fetch(`${API_URL}/mocks`);
            const data = await response.json();

            const list = document.getElementById('mocks-list');
            list.innerHTML = data.endpoints.map(mock => `
                <tr>
                    <td>${mock.name}</td>
                    <td>${mock.path}</td>
                    <td><span class="badge">${mock.method}</span></td>
                    <td>
                        <button class="danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteMock('${mock.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function showCreateMockModal() {
            document.getElementById('mock-modal').classList.add('active');
        }

        async function saveMock() {
            const mock = {
                name: document.getElementById('mock-name').value,
                path: document.getElementById('mock-path').value,
                method: document.getElementById('mock-method').value,
                response: JSON.parse(document.getElementById('mock-response').value || '{}'),
            };

            try {
                await fetch(`${API_URL}/mocks`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(mock)
                });
                alert('Mock created!');
                closeMockModal();
                loadMocks();
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // GraphQL
        async function loadGraphQLQueries() {
            const response = await fetch(`${API_URL}/graphql`);
            const data = await response.json();

            const list = document.getElementById('graphql-list');
            list.innerHTML = data.queries.map(q => `
                <tr>
                    <td>${q.name}</td>
                    <td>${q.endpoint}</td>
                    <td>
                        <button class="secondary" style="font-size: 12px; padding: 6px 12px;" onclick="executeGraphQL('${q.name}')">Execute</button>
                        <button class="danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteGraphQL('${q.name}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function showCreateGraphQLModal() {
            document.getElementById('graphql-modal').classList.add('active');
        }

        async function saveGraphQL() {
            const query = {
                name: document.getElementById('graphql-name').value,
                endpoint: document.getElementById('graphql-endpoint').value,
                query: document.getElementById('graphql-query').value,
                variables: JSON.parse(document.getElementById('graphql-variables').value || '{}'),
            };

            try {
                await fetch(`${API_URL}/graphql`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(query)
                });
                alert('GraphQL query saved!');
                closeGraphQLModal();
                loadGraphQLQueries();
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Template functions
        async function useTemplate(name) {
            try {
                const response = await fetch(`${API_URL}/templates/${name}`);
                const data = await response.json();
                if (!response.ok) {
                    alert(`Error: ${data.detail || data.error || 'Unknown error'}`);
                    return;
                }
                alert(`Applied template: ${name}\n\nMethod: ${data.method}\nURL: ${data.base_url || data.url || 'N/A'}\nHeaders: ${JSON.stringify(data.headers || {}, null, 2)}`);
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        async function deleteTemplate(name) {
            if (confirm(`Delete template "${name}"?`)) {
                await fetch(`${API_URL}/templates/${name}`, { method: 'DELETE' });
                loadTemplates();
            }
        }

        // Chain functions
        async function executeChain(name) {
            try {
                const response = await fetch(`${API_URL}/chains/${name}/execute`, { method: 'POST' });
                const data = await response.json();
                if (!response.ok) {
                    alert(`Error: ${data.detail || data.error || 'Unknown error'}`);
                    return;
                }
                const resultsSummary = data.results ? data.results.map(r => `${r.status_code} - ${(r.time_taken || 0).toFixed(2)}ms`).join('\n') : 'No results';
                alert(`Chain executed: ${name}\n\nRequests: ${data.requests_executed}\nTotal Time: ${(data.total_time || 0).toFixed(2)}ms\n\nResults:\n${resultsSummary}`);
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        async function deleteChain(name) {
            if (confirm(`Delete chain "${name}"?`)) {
                await fetch(`${API_URL}/chains/${name}`, { method: 'DELETE' });
                loadChains();
            }
        }

        // Mock functions
        async function deleteMock(name) {
            if (confirm(`Delete mock "${name}"?`)) {
                await fetch(`${API_URL}/mocks/${name}`, { method: 'DELETE' });
                loadMocks();
            }
        }

        async function startMockServer() {
            try {
                await fetch(`${API_URL}/mocks/server/start`, { method: 'POST' });
                alert('Mock server started!');
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        async function stopMockServer() {
            try {
                await fetch(`${API_URL}/mocks/server/stop`, { method: 'POST' });
                alert('Mock server stopped!');
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Auth functions
        async function deleteAuth(name) {
            if (confirm(`Delete auth config "${name}"?`)) {
                await fetch(`${API_URL}/auth/${name}`, { method: 'DELETE' });
                loadAuthConfigs();
            }
        }

        // GraphQL functions
        async function executeGraphQL(name) {
            try {
                const response = await fetch(`${API_URL}/graphql/${name}/execute`, { method: 'POST' });
                const data = await response.json();
                if (!response.ok) {
                    alert(`Error: ${data.detail || data.error || 'Unknown error'}`);
                    return;
                }
                alert(`GraphQL executed: ${name}\n\nResponse:\n${JSON.stringify(data, null, 2)}`);
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        async function deleteGraphQL(name) {
            if (confirm(`Delete GraphQL query "${name}"?`)) {
                await fetch(`${API_URL}/graphql/${name}`, { method: 'DELETE' });
                loadGraphQLQueries();
            }
        }

        // Metrics functions
        async function showMetricsStats() {
            try {
                const response = await fetch(`${API_URL}/metrics/stats`);
                const data = await response.json();
                alert(`Metrics Statistics:\n\nTotal Requests: ${data.total_requests}\nAverage Response Time: ${data.average_response_time.toFixed(2)}ms\nSuccess Rate: ${data.success_rate.toFixed(2)}%\nFailed Requests: ${data.failed_requests}`);
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Import/Export functions
        async function importRequests() {
            const input = prompt('Enter import format (postman, insomnia, openapi, or json):');
            if (!input) return;
            
            try {
                const response = await fetch(`${API_URL}/import`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ format: input, data: {} })
                });
                const data = await response.json();
                alert(`Imported ${data.count} requests!`);
                loadRequests();
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        async function exportRequests() {
            const format = prompt('Enter export format (postman, insomnia, openapi, or json):');
            if (!format) return;
            
            try {
                const response = await fetch(`${API_URL}/export?format=${format}`);
                const data = await response.json();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `apiclient-export.${format}.json`;
                a.click();
                alert('Export downloaded!');
            } catch (e) {
                alert('Error: ' + e);
            }
        }

        // Modal closing functions
        function closeModal(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        function closeRequestModal() {
            document.getElementById('request-modal').classList.remove('active');
        }

        function closeChainModal() {
            document.getElementById('chain-modal').classList.remove('active');
        }

        function closeTemplateModal() {
            document.getElementById('template-modal').classList.remove('active');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.remove('active');
        }

        function closeMockModal() {
            document.getElementById('mock-modal').classList.remove('active');
        }

        function closeGraphQLModal() {
            document.getElementById('graphql-modal').classList.remove('active');
        }

        // Initialize
        window.addEventListener('load', loadDashboard);
    </script>
</body>
</html>
